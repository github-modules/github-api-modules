{"name":"micro-toolkit-api-generators","version":"1.14.1","description":"[![Build Status](https://travis-ci.org/micro-toolkit/api-generator-js.svg?branch=master)](https://travis-ci.org/micro-toolkit/api-generator-js) [![Code Climate](https://codeclimate.com/github/micro-toolkit/api-generator-js/badges/gpa.svg)](https://codecli","main":"index.js","scripts":{"test":"npm run lint && NODE_ENV=test istanbul cover _mocha -- tests/* -R spec","lint":"jshint lib/**/*.js *.js tests/**/*.js"},"license":"ISC","dependencies":{"body-parser":"^1.15.2","express":"^4.14.0","express-partial-response":"^0.3.4","lodash":"^4.14.0","lodash-inflection":"^1.4.0","logger-facade-nodejs":"1.0.1","request-id":"^0.11.0","zmq-service-suite-client":"0.2.1"},"devDependencies":{"chai":"^3.5.0","chai-as-promised":"^6.0.0","grunt":"^1.0.1","grunt-bump":"^0.8.0","istanbul":"^0.4.4","jshint":"^2.9.2","mocha":"^2.5.3","q":"^1.4.1","sinon":"^1.17.5","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0","supertest":"^1.2.0"},"gitHead":"716cac664090484083326e01ff4218c10ae2dc13","versions":[{"number":"1.0.0","date":"2016-02-19T12:15:30.937Z"},{"number":"1.1.0","date":"2016-02-19T16:56:16.271Z"},{"number":"1.2.0","date":"2016-02-22T14:33:53.377Z"},{"number":"1.2.1","date":"2016-02-26T10:51:04.149Z"},{"number":"1.3.0","date":"2016-02-26T14:05:58.842Z"},{"number":"1.3.1","date":"2016-02-29T10:23:08.441Z"},{"number":"1.3.2","date":"2016-03-04T11:18:51.090Z"},{"number":"1.4.0","date":"2016-03-07T18:26:35.488Z"},{"number":"1.4.1","date":"2016-03-10T12:35:47.736Z"},{"number":"1.5.0","date":"2016-03-14T22:19:49.486Z"},{"number":"1.5.1","date":"2016-03-14T22:55:32.251Z"},{"number":"1.6.0","date":"2016-03-16T19:18:20.429Z"},{"number":"1.7.0","date":"2016-03-18T13:20:23.542Z"},{"number":"1.7.1","date":"2016-03-25T17:23:00.582Z"},{"number":"1.8.0","date":"2016-03-28T15:15:31.149Z"},{"number":"1.9.0","date":"2016-04-06T08:27:53.311Z"},{"number":"1.9.1","date":"2016-04-11T17:45:02.709Z"},{"number":"1.9.2","date":"2016-04-28T16:11:50.009Z"},{"number":"1.9.3","date":"2016-05-04T13:00:24.402Z"},{"number":"1.10.0","date":"2016-05-27T15:24:13.829Z"},{"number":"1.10.1","date":"2016-07-29T11:30:52.096Z"},{"number":"1.10.2","date":"2016-07-29T14:24:15.783Z"},{"number":"1.11.0","date":"2016-08-03T17:33:08.069Z"},{"number":"1.11.1","date":"2016-08-04T14:45:55.886Z"},{"number":"1.12.0","date":"2016-09-13T11:21:07.452Z"},{"number":"1.13.0","date":"2016-12-09T13:44:27.999Z"},{"number":"1.14.0","date":"2017-05-09T16:43:33.965Z"},{"number":"1.14.1","date":"2017-05-10T15:09:31.247Z"}],"readme":"[![Build Status](https://travis-ci.org/micro-toolkit/api-generator-js.svg?branch=master)](https://travis-ci.org/micro-toolkit/api-generator-js)\n[![Code Climate](https://codeclimate.com/github/micro-toolkit/api-generator-js/badges/gpa.svg)](https://codeclimate.com/github/micro-toolkit/api-generator-js)\n[![Test Coverage](https://codeclimate.com/github/micro-toolkit/api-generator-js/badges/coverage.svg)](https://codeclimate.com/github/micro-toolkit/api-generator-js/coverage)\n[![Issue Count](https://codeclimate.com/github/micro-toolkit/api-generator-js/badges/issue_count.svg)](https://codeclimate.com/github/micro-toolkit/api-generator-js)\n[![Dependency Status](https://gemnasium.com/micro-toolkit/api-generator-js.svg)](https://gemnasium.com/micro-toolkit/api-generator-js)\n\n# Micro Toolkit API Generators\n\n[![npm](https://img.shields.io/npm/v/micro-toolkit-api-generators.svg)](https://www.npmjs.com/package/micro-toolkit-api-generators)\n\nThe Micro toolkit API generators will allow you to generate express handlers to connect to the micro toolkit services using a set of code conventions.\n\nThe generator is based on the concept of models that are described using metadata. Every model have a microservice associated to, this service should have required operations available.\n\nFollowing the api example we have 2 models:\n* task: representing a todo task item, that is associated with a user;\n* user: representing the user, that can have a list of task associated to;\n\nThe metadata files that describe the models, present on each version, should have the following format:\n\nProperty    | Description\n------------|------------\nproperties  | A whitelist of properties associated with the model, only this properties are returned by the api serialization.\nrelations   | A collection of relations associated with the model.\nactions     | A list of actions available on the model (list, get, create, remove, update).\n\n```javascript\nvar taskMetadata = {\n  properties: [ \"id\", \"userId\", \"active\" ],\n  relations: [\n    {\n      name: \"user\",\n      type: \"resource\"\n    }\n  ],\n  actions: [\"list\", \"get\", \"create\", \"update\", \"remove\", \"count\"]\n}\n```\n\nThe list of actions will be translated into the following actions:\n* list:   `GET /v1/tasks`\n* get:    `GET /v1/tasks/:id`\n* create: `POST /v1/tasks`\n* update: `PUT /v1/tasks/:id`\n* remove: `DELETE /v1/tasks/:id`\n* count:   `GET /v1/tasks/count`\n\nThe relations will result on the following endpoints depending on the type:\n* resource:   `GET /v1/users/:id`\n* collection: `GET /v1/users/:id/tasks`\n\n## Install\n\n    $ npm install micro-toolkit-api-generator --save\n\n## Usage\n\nThe metadata should be dictionary where each key identifies the version identifier and the value should be a dictionary with the models description.\n\n```javascript\n// metadata from api-example project\nvar metadata = {\n  v1: {\n    task: {\n      properties: [ \"id\", \"userId\", \"active\" ],\n      relations: [\n        {\n          name: \"user\",\n          type: \"resource\"\n        }\n      ],\n      actions: [\"list\", \"get\", \"create\", \"update\", \"remove\", \"count\"]\n    },\n    user: {\n      properties: [ \"id\", \"name\" ],\n      relations: [\n        {\n          \"name\": \"tasks\",\n          \"type\": \"collection\"\n        }\n      ],\n      \"actions\": [\"get\"]\n    }\n  }\n};\n```\n\n## Expose the api routes\n\nThe following snipets will allow you to add the api generator routes into a express application. To configure logger plugins check the [project instructions](https://github.com/micro-toolkit/logger-facade-nodejs).\n\n```javascript\nvar express = require('express');\nvar apiRouter = require('../../index');\n\nvar config = {\n  runtimeConfig: { baseUrl: 'http://localhost:8081' },\n  // metadata from api-example project\n  metadata: metadata\n};\nvar app = express();\nvar router = apiRouter(config);\napp.use(router);\napp.listen(8081);\n```\n\n## Forwarding claims to service\n\nThe api generators allow to forward request claims into the microservice using the microservice header property on call. The api generator will use `req.user` to whitelist the claims selected. To use this feature the application just need to use a middleware to set `req.user` and define the whitelisted properties using the following configuration.\n\n```javascript\nvar express = require('express');\nvar apiRouter = require('../../index');\n\nvar config = {\n  runtimeConfig: {\n    baseUrl: 'http://localhost:8081',\n    claims: 'userId,tenantId'\n  },\n  // metadata from api-example project\n  metadata: metadata\n};\nvar app = express();\nvar router = apiRouter(config);\n// emulate auth middlware\napp.use(function(req, res, next){\n  var claims = { userId: '1', tenantId: '2' };\n  req.user = claims;\n  next();\n});\napp.use(router);\napp.listen(8081);\n```\n\n## Excluding some parameters from query string\n\nBy default the api generators will forward to the service all query string parameters except token and access_token. To override this configuration and have control over it the application can specificly set wich parameters to filter.\n\n\n```javascript\nvar config = {\n  runtimeConfig: {\n    baseUrl: 'http://localhost:8081',\n    excludeQueryString: 'token,somethingElse'\n  },\n  // metadata from api-example project\n  metadata: metadata\n};\n```\n\n## Support non standard actions\n\nThe default supported actions are `list, get, create, remove, update`, but the toolkit also support non standard action over a resource.\n\nSee following metadata example:\n\n```javascript\n// metadata from api-example project\nvar metadata = {\n  v1: {\n    user: {\n      properties: [ \"id\", \"name\", \"active\" ],\n      relations: [\n        {\n          name: \"tasks\",\n          type: \"collection\"\n        }\n      ],\n      actions: [\n        \"get\",\n        { name: \"active\", httpVerb: \"PUT\", verb: \"activate\" },\n        { name: \"active\", httpVerb: \"DELETE\", verb: \"deactivate\" }\n      ]\n    }\n\n  }\n};\n```\n\nThe previous metadata will generate the following routes:\n\n* `PUT /v1/users/:id/active` - that will call verb `activate` on the service, this operation should return the user model serialization\n* `DELETE /v1/users/:id/active` - that will call verb `deactivate` on the service, this operation will not return any response body from the api\n\n**NOTE**\n\nAt the moment the only support http verbs are: `PUT, POST, DELETE`. The `PUT, POST` verbs should return the model serialization.\n\n## Support subresource models\n\nIf we have a model that is dependent on a parent model, we can configure it in the model. This configuration will make the api routes being dependent on the parent resource routes.\n\nAs an example we can have the following model configuration (metadata from api-example project):\n\n```json\n{\n  \"parent\": \"user\",\n  \"properties\": [ \"id\", \"name\", \"userId\"],\n  \"actions\": [\"list\", \"get\", \"create\", \"update\", \"remove\"],\n  \"relations\": [\n    {\n      \"name\": \"user\",\n      \"type\": \"resource\"\n    }\n  ]\n}\n```\n\nThis will generate the following routes:\n\n    MICRO.API.METADATA::INFO - Loaded API Models...\n    MICRO.API.METADATA::INFO - Loading API routes...\n    MICRO.API.METADATA::TRACE - Mount route GET     /v1/users/:userId/roles\n    MICRO.API.METADATA::TRACE - Mount route GET     /v1/users/:userId/roles/:id\n    MICRO.API.METADATA::TRACE - Mount route POST    /v1/users/:userId/roles\n    MICRO.API.METADATA::TRACE - Mount route PUT     /v1/users/:userId/roles/:id\n    MICRO.API.METADATA::TRACE - Mount route DELETE  /v1/users/:userId/roles/:id\n    ...\n    MICRO.API.METADATA::INFO - Loaded API routes...\n    MICRO.API::INFO - Server running on port 8081\n\nThe parameters `userId` and `id`(on resource endpoints only) will be sent to service on payload.\n\n## Support path prefix\n\nIf we have a model that needs to have a prefix path we may configure it using path key. This configuration will make the api routes prefixed with the path.\n\nAs an example we can have the following model configuration (metadata from api-example project):\n\n```json\n{\n  \"properties\": [ \"name\", \"userId\" ],\n  \"relations\": [{ \"name\": \"user\", \"type\": \"resource\" }],\n  \"actions\": [\"list\"],\n  \"path\": {\n    \"prefix\": \"admin/\"\n  }\n}\n```\n\nThis will generate the following routes:\n\n    MICRO.API.METADATA::INFO - Loaded API Models...\n    MICRO.API.METADATA::INFO - Loading API routes...\n    MICRO.API.METADATA::TRACE - Mount route GET \t/v1/admin/claims\n\n## Overriding default paths\n\nThe path property allow you to override the default path configuration. The default path configuration is to transform the model name in a pluralized string, in certain cases we may need something different we can use path property.\n\nAs an example we can have the following model configuration (metadata api-example project):\n\n```json\n{\n  \"path\": \"me\",\n  \"currentUserKey\": \"userId\",\n  \"properties\": [\"id\", \"name\", \"active\"],\n  \"relations\": [{ \"name\": \"alerts\", \"type\": \"collection\" }],\n  \"actions\": [\"get\"]\n}\n```\n\nThis will generate a route `GET /me` instead of `GET /mes`.\n\n\n## Support current user endpoints\n\nIf we have a model that doesn't needs an identifier to be requested such as `me`, we can define what is the property present in request user object that should be sent in the payload.\n\nAs an example we can have the following model configuration (metadata api-example project):\n\n```json\n{\n  \"path\": \"me\",\n  \"currentUserKey\": \"userId\",\n  \"properties\": [\"id\", \"name\", \"active\"],\n  \"relations\": [{ \"name\": \"alerts\", \"type\": \"collection\" }],\n  \"actions\": [\"get\"]\n}\n```\n\nThis will generate a route `GET /me` where the property `userId` will be sent in the payload. The value for the userId property will be retrieved from current user object `req.user`.\n\nThe following model contains a alert relation and the `userId` property will also be sent in the relation payload.\n\n## Embeds support\n\nThis feature will allow to embed relations in the resource payload using a single call from the consumer. The relations can be a collection or single resource depending on the model definition. The relation name will be set as a property in the model payload.\n\nThe embeds will use the `batch` operation from embedable model using the following payload contract for request and response:\n\n* `one-to-one` relations will send the following payload:\n\n```javascript\n// Batch request payload example to embed users in a task model\n{ id: ['pjanuario'] }\n\n// Response:\n[\n  {\n    id: 'pjanuario',\n    data: {\n      id: \"pjanuario\",\n      name: \"Pedro\",\n      active: true,\n      roleId: \"1\",\n      _links: {\n        self: \"/users/pjanuario\",\n        tasks: \"/users/pjanuario/tasks\",\n        userAssignments: \"/users/pjanuario/userassignments\",\n        role: \"/users/pjanuario/roles/1\"\n      }\n    }\n  }\n]\n```\n\n* `one-to-many` relations will send the following payload:\n\n```javascript\n// Batch request payload example to embed tasks in a user model\n{ userId: ['pjanuario'] }\n\n// Response:\n[\n  {\n    userId: 'pjanuario',\n    data: [{\n      id: \"1\",\n      active: true,\n      userId: \"pjanuario\",\n      _links: {\n        self: \"/tasks/1\",\n        user: \"/users/pjanuario\"\n      }\n    }]\n  }\n]\n```\n\n## Contributing\n\n1. Fork it\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create new Pull Request\n\n## Bump versioning\n\nWe use [grunt bump package](https://www.npmjs.org/package/grunt-bump) to control package versioning.\n\nBump Patch version\n\n    $ grunt bump\n\nBump Minor version\n\n    $ grunt bump:minor\n\nBump Major version\n\n    $ grunt bump:major\n\n## Running Specs\n\n    $ npm test\n\n## Coverage Report\n\nWe aim for 100% coverage and we hope it keeps that way! :)\nWe use pre-commit and pre-push hooks and CI to accomplish this, so don't mess with our build! :P\n\nCheck the report after running npm test.\n\n    $ open ./coverage/lcov-report/index.html\n","created":"2016-02-19T12:15:30.937Z","modified":"2017-05-10T15:09:31.247Z","lastPublisher":{"name":"pjanuario","email":"prnjanuario@gmail.com"},"owners":[{"name":"pjanuario","email":"prnjanuario@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"micro-toolkit-api-generators","_nodeVersion":"7.5.0","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/micro-toolkit-api-generators-1.14.1.tgz_1494428969122_0.7362430759239942"},"_npmUser":{"name":"pjanuario","email":"prnjanuario@gmail.com"},"_npmVersion":"4.1.2","_rev":"4-283e7e79f15f66ee05e376a0336c4e56","_shasum":"2fbbada65ac00991d6422401b2e71b129377489b","author":{"name":"Pedro Januário","email":"prnjanuario@gmail.com"},"directories":{},"dist-tags":{"latest":"1.14.1"},"dist":{"shasum":"2fbbada65ac00991d6422401b2e71b129377489b","tarball":"https://registry.npmjs.org/micro-toolkit-api-generators/-/micro-toolkit-api-generators-1.14.1.tgz"},"maintainers":[{"name":"pjanuario","email":"prnjanuario@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-05-10T15:09:31.247Z","created":"2016-02-19T12:15:30.937Z","1.0.0":"2016-02-19T12:15:30.937Z","1.1.0":"2016-02-19T16:56:16.271Z","1.2.0":"2016-02-22T14:33:53.377Z","1.2.1":"2016-02-26T10:51:04.149Z","1.3.0":"2016-02-26T14:05:58.842Z","1.3.1":"2016-02-29T10:23:08.441Z","1.3.2":"2016-03-04T11:18:51.090Z","1.4.0":"2016-03-07T18:26:35.488Z","1.4.1":"2016-03-10T12:35:47.736Z","1.5.0":"2016-03-14T22:19:49.486Z","1.5.1":"2016-03-14T22:55:32.251Z","1.6.0":"2016-03-16T19:18:20.429Z","1.7.0":"2016-03-18T13:20:23.542Z","1.7.1":"2016-03-25T17:23:00.582Z","1.8.0":"2016-03-28T15:15:31.149Z","1.9.0":"2016-04-06T08:27:53.311Z","1.9.1":"2016-04-11T17:45:02.709Z","1.9.2":"2016-04-28T16:11:50.009Z","1.9.3":"2016-05-04T13:00:24.402Z","1.10.0":"2016-05-27T15:24:13.829Z","1.10.1":"2016-07-29T11:30:52.096Z","1.10.2":"2016-07-29T14:24:15.783Z","1.11.0":"2016-08-03T17:33:08.069Z","1.11.1":"2016-08-04T14:45:55.886Z","1.12.0":"2016-09-13T11:21:07.452Z","1.13.0":"2016-12-09T13:44:27.999Z","1.14.0":"2017-05-09T16:43:33.965Z","1.14.1":"2017-05-10T15:09:31.247Z"}}}